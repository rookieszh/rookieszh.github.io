---
title: Open System Interconnection Introduction
date: 2019-05-19 18:32:22
categories:
    - Internet
tags:
    - OSI
description: "开放式系统互联模型，即我们常说的网络通信7层协议。本文介绍了七层模型的内容与概念。"
fancybox: true  # 图片浏览器
toc: true       # 文章目录
original: true  # 文末版权信息 
comments: true  # 文末评论
share: true     # 分享
---


## OSI 网络体系结构与 TCP/IP 协议模型
> OSI 是一个理论上的网络通信模型，而 TCP/IP 则是实际上的网络通信标准。但是，它们的初衷是一样的，都是为了使得两台计算机能够像两个知心朋友那样能够互相准确理解对方的意思并做出优雅的回应。
> 分层划分的结构，既能规定不同层完成的功能，又能实现层与层之间的改动而不相互影响。
> 起初网络分层是标准的七层，也就是 OSI 七层模型。之后又诞生了 TCP/IP 五层模型。

![](网络分层模型_1.png)
![](网络协议常见面试题8.png)

### 物理层
参考模型的最低层，也是OSI模型的第一层，实现了相邻计算机节点之间比特流的透明传送，并尽可能地屏蔽掉具体传输介质和物理设备的差异，使其上层(数据链路层)不必关心网络的具体传输介质。
### 数据链路层 data link layer
接收来自物理层的位流形式的数据，并封装成帧，传送到上一层；同样，也将来自上层的数据帧，拆装为位流形式的数据转发到物理层。这一层在物理层提供的比特流的基础上，通过差错控制、流量控制方法，使有差错的物理线路变为无差错的数据链路，即提供可靠的通过物理介质传输数据的方法。
#### 以太网协议
> 以太网规定，每组的电信号就是一个数据包，每个数据包我们可以称为“帧”。每帧的组成是由标头(Head)和数据(Data)组成。

##### 标头
用于供接收端判断该帧是否是发送给自己的。
数据包的标头中通常会存放一些有关数据包的说明、发送者是谁、接受者又是谁等相关识别信息。
标头的长度固定为 18 字节，也就是说，一些标头识别信息的大小不能超过 18 字节。
##### 数据
是整个数据包的具体内容，比如文件、字符串之类的。
数据部分的长度最小至少为 46 个字节，最长 1500 字节。我们可能会想到，如果小于 46 字节没啥问题可以存放开，那么大于 1500 字节怎么处理呢？很简单，我们就分成两个包处理（分割），两个包存放不下就分割成三个包。
#### 广播
广播的作用就是用来查找接收端的 MAC 地址，从而进行下一步的数据传输。注意，广播只是一种发送数据的形式，而计算机想要知道另一台计算机的 MAC 地址是通过 ARP 协议解决的。
稍微屡一下，我们想要发送数据，首先要知道对方的唯一标识（MAC 地址），要想知道对方的 MAC 地址，需要使用 ARP 协议，假设我们通过 ARP 协议拿到了接收方的 MAC 地址。
我们开始发送数据，将发送方的 MAC 地址和接收方的 MAC 地址封装在数据包中，然后发送端向同一子网络中（同一局域网）中的所有计算机发送该数据包，所有的计算机接收到该包之后，就对数据包的头部进行提取，提取出里边封装好的接收端 MAC 地址和自己的 MAC 地址作比对，如果相同，就说明该数据包是给自己发送的，否则，就会丢弃该数据包，这个过程就是广播的过程。
如果不在同一局域网中我们怎么处理？我们平常使用无线网都知道每个无线局域网都会有一个路由器，我们先通过以上的方法将数据发送到路由器，然后路由器转发数据到其他局域网中的计算机。

### 网络层
将网络地址翻译成对应的物理地址，并通过路由选择算法为分组通过通信子网选择最适当的路径。
![](网络协议常见面试题9.png)

#### IP协议与子网掩码
> 网络层中最重要的一个协议就是 IP 协议，我们一般发送端给服务端发送数据同时要知道两个地址才能准确送达到对方，分别为 IP 地址和 MAC 地址。

IP 的数据包是直接放入到以太网数据包的“数据”部分的，这样做有一个好处就是“上层的变动完全涉及不到下层的结构”。然后数据包就变成这个样子了。
![](网络分层模型_2.png)

IP 数据包也分为标头(Head)和数据(Data)两部分。
1. 标头
IP 数据包的标头是 20 ~ 60 字节，主要包括版本、IP 地址等信息。
2. 数据
数据的最大长度为 65515 字节。整个 IP 数据包的最大总长度为 65535 字节。主要存放 IP 数据包的具体内容。

问题来了，以太网的数据部分最长为 1500 字节，你把一个长度为 65535 字节的 IP 数据包放到以太网的数据包汇总，不会被撑破吗？你在逗我么？确实是呀，那我们就分割数据包吧，分割成几个以太网数据包分开发送。

将 IP 地址抽象成一种逻辑上的地址，也就是说 MAC 地址是物理上的地址，就是定死了。而IP 地址是动态分配的，不是固定死的。
我们就是通过 IP 地址来判断两个计算机设备是否在同一子网络中的，具体利用子网掩码。
IP 地址是由 32 个二进制位组成的，也就是四个十进制（如：255.255.255.000）。
子网掩码也是由 32 个二进制位组成的，但是只能用 0 或 1 来表示，如11111111.11111111.11111111.00000000。

有 1 的部分表示网络部分，有 0 表示主机部分，两台计算机的 IP 地址分别和子网掩码进行一种运算（AND 运算），如果结果相同，两台计算机就在同一局域网中，否则就不在同一局域网中。
#### ARP 协议
> 前提：对方的 IP 地址是已知的，通过 DNS 解析得到。

ARP 协议发出一个数据包，包含在以太网的数据包中（其中包含对方的 IP 地址，对方的 MAC 地址栏是 FF:FF:FF:FF:FF:FF）。子网络中的每台主机都会收到这个包，然后从中取出 IP 地址与自身对比，如果两者相同，都做出回复，向对方报告自己的 MAC 地址，否则就丢弃这个包。

### 传输层 transport layer
传输层的主要功能就是为了能够实现“端口到端口”的通信。计算机上运行的不同程序都会分配不同的端口，所以才能使得数据能够正确的传送给不同的应用程序。
在源端与目的端之间提供可靠的透明数据传输，使上层服务用户不必关系通信子网的实现细节。在协议栈中，传输层位于网络层之上，传输层协议为不同主机上运行的进程提供逻辑通信，而网络层协议为不同主机提供逻辑通信，如下图所示。
![](网络协议常见面试题10.png)
实际上，网络层可以看作是传输层的一部分，其为传输层提供服务。但对于终端系统而言，网络层对它们而言是透明的，它们只知道传输层的存在，也就是说，在逻辑上它们认为是传输层为它们提供了端对端的通信，这也是分层思想的妙处。
#### UDP协议
加入端口号也需要一套规则，那就是 UDP 协议，但是 UDP 协议有个缺点，一旦进行通信，就不知道对方是否接收到数据了，我们再定义一套规则，让其可以和对方进行确认，那么 TCP 出现了。

UDP 协议也分为标头(Head)和数据(Data)两部分。
1. 标头
标头的长度为 8 字节。主要存放了发送和接收端口号。
2. 数据
数据部分和标头部分的总长度不超过 65535 字节，正好放进一个IP数据包。

前边也讲过，数据包之间是包含关系的，所以 UDP 的数据包是放到 IP 数据包的“数据”部分的，IP 数据包又放在以太网数据包的“数据”部分的。

![](网络分层模型_3.png)
#### TCP 协议
我们通常说 TCP 三次握手和四次挥手，这就是传输层中完成的。
TCP 的数据包和 UDP 相同嵌入在 IP 协议的“数据”部分，TCP 并没有长度限制，但是为了保证传输效率，肯定要进行限制的，TCP 的数据包的长度一般不会超过 IP 数据包的长度了，保证单个的 TCP 数据包不再进行分割。
### 会话层 Session Layer
会话层是OSI模型的第五层，是用户应用程序和网络之间的接口，负责在网络中的两节点之间建立、维持和终止通信。
### 表示层 Presentation Layer
> 数据的编码，压缩和解压缩，数据的加密和解密

表示层是OSI模型的第六层，它对来自应用层的命令和数据进行解释，以确保一个系统的应用层所发送的信息可以被另一个系统的应用层读取。
### 应用层 Application layer
为用户的应用进程提供网络通信服务
应用层是最高一层，直接面向用户，它的数据包会放在 TCP 的数据包的“数据”部分，那么整个五层的数据包就会变成一下这样。

![](网络分层模型_4.png)
